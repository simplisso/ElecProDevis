<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>√âlecProDevis ‚Äì Devis</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    :root {
      --bleu: #0077cc;
      --gris: #f0f4f8;
      --blanc: #ffffff;
      --ombre: rgba(0, 0, 0, 0.1);
    }
    body {
      margin: 0;
      padding: 20px;
      background: var(--gris);
      font-family: 'Segoe UI', sans-serif;
      color: #333;
    }
    .container {
      max-width: 960px;
      margin: auto;
      background: var(--blanc);
      padding: 30px;
      border-radius: 16px;
      box-shadow: 0 8px 24px var(--ombre);
    }
    h1 {
      text-align: center;
      color: var(--bleu);
      margin-bottom: 30px;
    }
    .infos {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      margin-bottom: 30px;
    }
    .infos div {
      flex: 1;
      min-width: 200px;
      margin-bottom: 10px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 30px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 12px;
      text-align: left;
      font-size: 0.95em;
    }
    th {
      background-color: var(--bleu);
      color: white;
    }
    tr:nth-child(even) {
      background-color: #f4f4f4;
    }
    .total {
      text-align: right;
      font-size: 1.2em;
      font-weight: bold;
      margin-top: 20px;
    }
    .actions {
      text-align: center;
      margin-top: 30px;
    }
    .actions button {
      background-color: var(--bleu);
      color: white;
      border: none;
      padding: 12px 20px;
      font-size: 1em;
      border-radius: 8px;
      cursor: pointer;
      margin: 5px;
    }
    .actions button:hover {
      background-color: #005fa3;
    }
    @media print {
      .actions {
        display: none;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üìÑ Devis g√©n√©r√©</h1>
    <div class="infos">
      <div><strong>üë§ Client :</strong> <span id="client"></span></div>
      <div><strong>üë®‚Äçüîß Technicien :</strong> <span id="electricien"></span></div>
      <div><strong>üìÖ Date :</strong> <span id="date"></span></div>
    </div>

    <table id="tableProduits">
      <thead>
        <tr>
          <th>Produit</th>
          <th>Qt√©</th>
          <th>PU HT</th>
          <th>TVA</th>
          <th>Total TTC</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <div class="total" id="mainOeuvre"></div>
    <div class="total" id="totalGlobal"></div>

    <div class="actions">
      <button onclick="window.print()">üñ®Ô∏è Imprimer</button>
      <button onclick="window.location.href='accueil.html'">üîÅ Nouveau devis</button>
    </div>
  </div>

  <script>
    const client = localStorage.getItem("client") || "";
    const electricien = localStorage.getItem("electricien") || "";
    const date = localStorage.getItem("date") || "";
    const modeMain = localStorage.getItem("modeMain") || "auto";
    const produits = JSON.parse(localStorage.getItem("produits") || "[]");

    document.getElementById("client").textContent = client;
    document.getElementById("electricien").textContent = electricien;
    document.getElementById("date").textContent = date;

    let totalProduits = 0;
    const tbody = document.querySelector("#tableProduits tbody");

    produits.forEach(p => {
      const totalHT = p.prix * p.quantite;
      const montantTVA = totalHT * (p.tva || 0) / 100;
      const totalTTC = totalHT + montantTVA;
      totalProduits += totalTTC;

      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${p.nom}</td>
        <td>${p.quantite}</td>
        <td>${p.prix} FCFA</td>
        <td>${p.tva || 0}%</td>
        <td>${totalTTC.toFixed(0)} FCFA</td>
      `;
      tbody.appendChild(tr);
    });

    let mainTTC = 0;
    let texteMain = "";

    if (modeMain === "auto") {
      const heures = parseFloat(localStorage.getItem("heures") || "0");
      const tarif = parseFloat(localStorage.getItem("tarifHoraire") || "0");
      const tva = parseFloat(localStorage.getItem("tvaMain") || "0");

      const totalHT = heures * tarif;
      const montantTVA = totalHT * tva / 100;
      mainTTC = totalHT + montantTVA;

      texteMain = `üõ†Ô∏è Main-d‚Äô≈ìuvre : ${heures}h √ó ${tarif} FCFA + ${tva}% = <strong>${mainTTC.toFixed(0)} FCFA TTC</strong>`;
    } else {
      mainTTC = parseFloat(localStorage.getItem("mainManuelle") || "0");
      texteMain = `üõ†Ô∏è Main-d‚Äô≈ìuvre (manuel) : <strong>${mainTTC.toFixed(0)} FCFA TTC</strong>`;
    }

    document.getElementById("mainOeuvre").innerHTML = texteMain;

    const totalGlobal = totalProduits + mainTTC;
    document.getElementById("totalGlobal").innerHTML = `üí∞ Total TTC global : <strong>${totalGlobal.toFixed(0)} FCFA</strong>`;
  </script>
</body>
</html>
